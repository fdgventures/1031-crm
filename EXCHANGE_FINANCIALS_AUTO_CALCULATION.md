# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á–µ—Ç —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö –ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–π Exchange

## –û–±–∑–æ—Ä

–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã—á–∏—Å–ª—è–µ—Ç —Ç—Ä–∏ –∫–ª—é—á–µ–≤—ã–µ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –≤–µ–ª–∏—á–∏–Ω—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ 1031 Exchange –Ω–∞ –æ—Å–Ω–æ–≤–µ accounting entries (–ø—Ä–æ–≤–æ–¥–æ–∫):

1. **Total Sale Property Value** - –û–±—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –ø—Ä–æ–¥–∞–Ω–Ω–æ–π –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏
2. **Total Replacement Property** - –û–±—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –ø—Ä–∏–æ–±—Ä–µ—Ç–µ–Ω–Ω–æ–π –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏
3. **Value Remaining** - –û—Å—Ç–∞—Ç–æ–∫, –∫–æ—Ç–æ—Ä—ã–π –Ω—É–∂–Ω–æ —Ä–µ–∏–Ω–≤–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å

## –ü—Ä–∏–Ω—Ü–∏–ø —Ä–∞–±–æ—Ç—ã

### Total Sale Property Value (–û–±—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –ø—Ä–æ–¥–∞–∂–∏)

**–ò—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö:** Accounting entries —Å —Ç–∏–ø–æ–º `sale_proceeds`

**–õ–æ–≥–∏–∫–∞ —Ä–∞—Å—á–µ—Ç–∞:**
- –°—É–º–º–∏—Ä—É—é—Ç—Å—è –≤—Å–µ `credit` (–∫—Ä–µ–¥–∏—Ç—ã) –∏–∑ —Ç–∞–±–ª–∏—Ü—ã `accounting_entries`
- –ì–¥–µ `to_exchange_id = exchangeId` (–¥–µ–Ω—å–≥–∏ –ø–æ—Å—Ç—É–ø–∞—é—Ç –í exchange)
- –ò `entry_type = 'sale_proceeds'` –∏–ª–∏ `credit > 0`

**–ö–æ–≥–¥–∞ —Å–æ–∑–¥–∞—é—Ç—Å—è –∑–∞–ø–∏—Å–∏:**
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ "Funds to Exchange" –≤ Settlement Statement (–ø—Ä–æ–¥–∞–∂–∞)
- –í—Ä—É—á–Ω—É—é —á–µ—Ä–µ–∑ Accounting Table

### Total Replacement Property (–û–±—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –ø–æ–∫—É–ø–æ–∫)

**–ò—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö:** Accounting entries —Å —Ç–∏–ø–æ–º `purchase_funds`

**–õ–æ–≥–∏–∫–∞ —Ä–∞—Å—á–µ—Ç–∞:**
- –°—É–º–º–∏—Ä—É—é—Ç—Å—è –≤—Å–µ `debit` (–¥–µ–±–µ—Ç—ã) –∏–∑ —Ç–∞–±–ª–∏—Ü—ã `accounting_entries`
- –ì–¥–µ `from_exchange_id = exchangeId` (–¥–µ–Ω—å–≥–∏ —É—Ö–æ–¥—è—Ç –ò–ó exchange)
- –ò `entry_type = 'purchase_funds'` –∏–ª–∏ `debit > 0`

**–ö–æ–≥–¥–∞ —Å–æ–∑–¥–∞—é—Ç—Å—è –∑–∞–ø–∏—Å–∏:**
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ "Funds from Exchange" –≤ Settlement Statement (–ø–æ–∫—É–ø–∫–∞)
- –í—Ä—É—á–Ω—É—é —á–µ—Ä–µ–∑ Accounting Table

### Value Remaining (–û—Å—Ç–∞—Ç–æ–∫ –¥–ª—è —Ä–µ–∏–Ω–≤–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)

**–§–æ—Ä–º—É–ª–∞:**
```
Value Remaining = Total Sale Property Value - Total Replacement Property
```

**–ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è:**
- **–ü–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ** (–æ—Ä–∞–Ω–∂–µ–≤—ã–π): –ù—É–∂–Ω–æ –µ—â–µ —Ä–µ–∏–Ω–≤–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å
- **–ù–æ–ª—å** (—Å–µ—Ä—ã–π): –ü–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–∏–Ω–≤–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ
- **–û—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ** (–∫—Ä–∞—Å–Ω—ã–π): –ü–µ—Ä–µ—Ä–µ–∏–Ω–≤–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ (–ø–æ–ª—É—á–µ–Ω boot/–Ω–∞–ª–æ–≥–æ–æ–±–ª–∞–≥–∞–µ–º–∞—è –±–∞–∑–∞)

## –†–µ–∞–ª–∏–∑–∞—Ü–∏—è

### –§–∞–π–ª—ã

**`src/lib/exchange-calculations.ts`** - –£—Ç–∏–ª–∏—Ç—ã –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞
- `calculateExchangeFinancials(exchangeId)` - –í—ã—á–∏—Å–ª—è–µ—Ç –≤—Å–µ —Ç—Ä–∏ –ø–æ–∫–∞–∑–∞—Ç–µ–ª—è
- `updateExchangeFinancials(exchangeId)` - –û–±–Ω–æ–≤–ª—è–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –≤ –ë–î (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- `getExchangeBalance(exchangeId)` - –¢–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å exchange

**`src/app/(pages)/exchanges/[id]/page.tsx`** - –°—Ç—Ä–∞–Ω–∏—Ü–∞ exchange
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–≥—Ä—É–∂–∞–µ—Ç –∏ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –≤—ã—á–∏—Å–ª–µ–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
- –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ—Ç –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ accounting entries
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –±–µ–π–¥–∂–∏ "Auto-calculated"

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ—Å—á–µ—Ç

–ü–µ—Ä–µ—Å—á–µ—Ç –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏:
1. **–ó–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã exchange**
2. **–ò–∑–º–µ–Ω–µ–Ω–∏–∏ accounting entries** (–¥–æ–±–∞–≤–ª–µ–Ω–∏–µ, —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ, —É–¥–∞–ª–µ–Ω–∏–µ)
3. **–í–∑—è—Ç–∏–∏ –∫–æ–º–∏—Å—Å–∏–∏** (Take Fee)

### UI/UX

**–û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ:**
- –ü–æ–ª—è –ø–æ–º–µ—á–µ–Ω—ã –±–µ–π–¥–∂–µ–º "Auto-calculated" (—Å–∏–Ω–∏–π)
- Total Sale Property Value - –∑–µ–ª–µ–Ω—ã–π —Ü–≤–µ—Ç
- Total Replacement Property - –∫—Ä–∞—Å–Ω—ã–π —Ü–≤–µ—Ç
- Value Remaining - –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π —Ü–≤–µ—Ç:
  - –û—Ä–∞–Ω–∂–µ–≤—ã–π: –Ω—É–∂–Ω–æ —Ä–µ–∏–Ω–≤–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å
  - –ö—Ä–∞—Å–Ω—ã–π: –ø–µ—Ä–µ—Ä–µ–∏–Ω–≤–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ
  - –°–µ—Ä—ã–π: –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–∏–Ω–≤–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ

**–ü–æ–¥—Å–∫–∞–∑–∫–∏:**
- "From sale proceeds in accounting"
- "From purchase funds in accounting"
- "Still needs to be reinvested" / "Over-invested (boot received)" / "Fully reinvested"

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

‚úÖ **–¢–æ—á–Ω–æ—Å—Ç—å** - –î–∞–Ω–Ω—ã–µ –±–µ—Ä—É—Ç—Å—è –Ω–∞–ø—Ä—è–º—É—é –∏–∑ accounting entries
‚úÖ **–ê–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç—å** - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –ø—Ä–æ–≤–æ–¥–æ–∫
‚úÖ **–ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å** - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç –∏—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö
‚úÖ **–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –ø—Ä–∞–≤–∏–ª–∞–º 1031** - –¢–æ—á–Ω–æ–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Ä–µ–∏–Ω–≤–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

## –°–≤—è–∑—å —Å –¥—Ä—É–≥–∏–º–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏

### Property Identification
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `totalSalePropertyValue` –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ –ø—Ä–∞–≤–∏–ª 1031 Exchange
- 3 Property Rule, 200% Rule, 95% Rule –∑–∞–≤–∏—Å—è—Ç –æ—Ç Total Sale Property Value

### Accounting Table
- –ò—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –≤—Å–µ—Ö —Ä–∞—Å—á–µ—Ç–æ–≤
- `onEntryChange` callback —Ç—Ä–∏–≥–≥–µ—Ä–∏—Ç –ø–µ—Ä–µ—Å—á–µ—Ç

### Settlement Statements
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—é—Ç accounting entries
- –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ "Funds to/from Exchange" –æ–±–Ω–æ–≤–ª—è—é—Ç —Ä–∞—Å—á–µ—Ç—ã

## –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

‚ö†Ô∏è **–í–∞–∂–Ω–æ:** –ü–æ–ª—è –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö (`total_sale_property_value`, `total_replacement_property`, `value_remaining`) —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è legacy data. –ê–∫—Ç—É–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –≤—Å–µ–≥–¥–∞ –≤—ã—á–∏—Å–ª—è—é—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏.

üí° **–°–æ–≤–µ—Ç:** –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –º–æ–∂–Ω–æ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è —Å –≤—ã—á–∏—Å–ª–µ–Ω–Ω—ã–º–∏ —á–µ—Ä–µ–∑ —Ñ—É–Ω–∫—Ü–∏—é `updateExchangeFinancials(exchangeId)`.

